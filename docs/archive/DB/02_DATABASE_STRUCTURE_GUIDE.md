# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ æ‹¡å¼µã‚¬ã‚¤ãƒ‰
## Phase 1-3: ãƒ•ãƒ«æ©Ÿèƒ½ã®Eã‚³ãƒžãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ§‹ç¯‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã®ã¿ã®ã‚·ãƒ³ãƒ—ãƒ«ãªDBã‚’ã€**æ³¨æ–‡ç®¡ç†ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’å‚™ãˆãŸæœ¬æ ¼çš„ãªEã‚³ãƒžãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã¸é€²åŒ–ã•ã›ã‚‹ãŸã‚ã®å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

---

## æ¦‚è¦

### ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®DBæ§‹æˆ

#### Phase 1ï¼ˆå®Œäº†ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼š`users` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿

#### Phase 2ï¼ˆæœ¬ã‚¬ã‚¤ãƒ‰ Step 1-3ï¼‰
- è£½å“ç®¡ç†ï¼š`product_categories`ã€`products` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
- è¤‡æ•°è£½å“ã®ä¸€å…ƒç®¡ç†ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡žæ©Ÿèƒ½

#### Phase 3ï¼ˆæœ¬ã‚¬ã‚¤ãƒ‰ Step 4-6ï¼‰
- æ³¨æ–‡ç®¡ç†ï¼š`orders`ã€`order_items` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
- ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ï¼š`reviews` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ³¨æ–‡å±¥æ­´ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»é›†è¨ˆæ©Ÿèƒ½

### æœ€çµ‚çš„ãªæ§‹æˆï¼ˆå®Ÿè£…å¾Œï¼‰

**6ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§æœ¬æ ¼çš„ãªEã‚³ãƒžãƒ¼ã‚¹æ©Ÿèƒ½ã‚’å®Ÿç¾:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† / ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç† / è£½å“ç®¡ç† / æ³¨æ–‡ç®¡ç† / æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç† / ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†

### ãƒ¡ãƒªãƒƒãƒˆ

- âœ… è¤‡æ•°è£½å“ã®ç®¡ç†
- âœ… ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡ž
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æ³¨æ–‡å±¥æ­´
- âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é›†è¨ˆ
- âœ… åœ¨åº«ç®¡ç†åŸºç›¤
- âœ… æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¿½è·¡

---

## ç›®æ¬¡

1. [æ‹¡å¼µå¾Œã®DBè¨­è¨ˆ](#æ‹¡å¼µå¾Œã®dbè¨­è¨ˆ)
2. [ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©](#ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©)
3. [å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—](#å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—)
4. [æ¤œè¨¼æ–¹æ³•](#æ¤œè¨¼æ–¹æ³•)
5. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## æ‹¡å¼µå¾Œã®DBè¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«é–¢ä¿‚å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users      â”‚ â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id [PK]      â”‚
â”‚ name         â”‚
â”‚ email [UQ]   â”‚
â”‚ created_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚         â”‚
 â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ orders â”‚  â”‚ reviews   â”‚
 â”‚(æ³¨æ–‡)  â”‚  â”‚(ãƒ¬ãƒ“ãƒ¥ãƒ¼)â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ N:1      â”‚ N:1
                 â”‚          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ products â”‚  â”‚ product_categoriesâ”‚
          â”‚(è£½å“)    â”‚  â”‚(ã‚«ãƒ†ã‚´ãƒªãƒ¼)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–²
                â”‚ N:N (order_itemsçµŒç”±)
                â”‚
          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”
          â”‚ orders â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆå…¨Phaseï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | ãƒ•ã‚¡ã‚¤ãƒ« | ä¿å­˜å…ˆ | èª¬æ˜Ž |
|--------|---------|--------|------|
| Phase 2 | `002_create_product_tables.sql` | `db/migrations/` | è£½å“ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« |
| Phase 2 | `002_product_categories.sql` | `db/seeds/` | ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ |
| Phase 2 | `003_products.sql` | `db/seeds/` | è£½å“ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ |
| Phase 3 | `003_create_orders_reviews.sql` | `db/migrations/` | æ³¨æ–‡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« |
| Phase 3 | `004_orders.sql` | `db/seeds/` | æ³¨æ–‡ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ |
| Phase 3 | `005_order_items.sql` | `db/seeds/` | æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ |
| Phase 3 | `006_reviews.sql` | `db/seeds/` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ |

---

## ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

### 1. users ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜ï¼‰

**ç”¨é€”:** ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç®¡ç†

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/001_create_users.sql`

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž |
|--------|-----|------|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ |
| `name` | VARCHAR(100) | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| `email` | VARCHAR(255) | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰ |
| `created_at` | TIMESTAMP | ä½œæˆæ—¥æ™‚ |

---

### 2. product_categories ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰

**ç”¨é€”:** è£½å“ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡ž

**è¨­è¨ˆç†ç”±:**
è£½å“ã‚’ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡žã™ã‚‹ã“ã¨ã§ã€æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã«å¯¾å¿œ

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/002_create_product_tables.sql` ã«å«ã¾ã‚Œã¾ã™

```sql
CREATE TABLE product_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    icon_url VARCHAR(500),
    display_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_name (name),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž | ä¾‹ |
|--------|-----|------|-----|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ | 1, 2, 3 |
| `name` | VARCHAR(100) UNIQUE | ã‚«ãƒ†ã‚´ãƒªãƒ¼åï¼ˆé‡è¤‡ä¸å¯ï¼‰ | ã€Œé›»å­æ©Ÿå™¨ã€ |
| `description` | TEXT | è©³ç´°èª¬æ˜Ž | ã€Œã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ...ã€ |
| `icon_url` | VARCHAR(500) | ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒURL | `/images/electronics.png` |
| `display_order` | INT | è¡¨ç¤ºé †åº | 1, 2, 3... |
| `is_active` | BOOLEAN | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚° | TRUE/FALSE |
| `created_at` | TIMESTAMP | ä½œæˆæ—¥æ™‚ | è‡ªå‹• |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¥æ™‚ | è‡ªå‹•æ›´æ–° |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:**
- `idx_name`: ã‚«ãƒ†ã‚´ãƒªãƒ¼åã§ã®é«˜é€Ÿæ¤œç´¢
- `idx_is_active`: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

---

### 3. products ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰

**ç”¨é€”:** è£½å“æƒ…å ±ç®¡ç†

**è¨­è¨ˆç†ç”±:**
è£½å“ã‚’ä¸€å…ƒç®¡ç†ã—ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜è£½å“ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/002_create_product_tables.sql` ã«å«ã¾ã‚Œã¾ã™

```sql
CREATE TABLE products (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    category_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    stock INT UNSIGNED NOT NULL DEFAULT 0,
    image_url VARCHAR(500),
    sku VARCHAR(100) UNIQUE,
    is_featured BOOLEAN DEFAULT FALSE,
    rating DECIMAL(3, 2) DEFAULT 0.00,
    reviews_count INT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (category_id) REFERENCES product_categories(id) ON DELETE RESTRICT,
    INDEX idx_category_id (category_id),
    INDEX idx_price (price),
    INDEX idx_is_featured (is_featured),
    FULLTEXT INDEX idx_fulltext_search (name, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž | ä¾‹ |
|--------|-----|------|-----|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ | 1, 2, 3 |
| `category_id` | BIGINT UNSIGNED (FK) | ã‚«ãƒ†ã‚´ãƒªãƒ¼ID | 1 |
| `name` | VARCHAR(200) | è£½å“å | ã€ŒiPhone 15 Proã€ |
| `description` | TEXT | è©³ç´°èª¬æ˜Ž | ã€Œé«˜æ€§èƒ½ãƒãƒƒãƒ—æ­è¼‰...ã€ |
| `price` | DECIMAL(10, 2) | ä¾¡æ ¼ | 150000.00 |
| `stock` | INT UNSIGNED | åœ¨åº«æ•° | 50 |
| `image_url` | VARCHAR(500) | è£½å“ç”»åƒURL | `/images/iphone15.jpg` |
| `sku` | VARCHAR(100) UNIQUE | å•†å“ã‚³ãƒ¼ãƒ‰ | ã€ŒSKU-001ã€ |
| `is_featured` | BOOLEAN | ç‰¹é›†è¡¨ç¤ºãƒ•ãƒ©ã‚° | TRUE/FALSE |
| `rating` | DECIMAL(3, 2) | å¹³å‡ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | 4.50 |
| `reviews_count` | INT UNSIGNED | ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•° | 120 |
| `created_at` | TIMESTAMP | ä½œæˆæ—¥æ™‚ | è‡ªå‹• |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¥æ™‚ | è‡ªå‹•æ›´æ–° |

**å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„:**
```
FOREIGN KEY (category_id) REFERENCES product_categories(id) ON DELETE RESTRICT
```
- å­˜åœ¨ã—ãªã„ã‚«ãƒ†ã‚´ãƒªãƒ¼IDã‚’æŒ‡å®šã§ããªã„
- ã‚«ãƒ†ã‚´ãƒªãƒ¼å‰Šé™¤æ™‚ã€é–¢é€£è£½å“ãŒã‚ã‚Œã°å‰Šé™¤ã‚’æ‹’å¦

---

### 4. orders ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ãƒ»Phase 3ï¼‰

**ç”¨é€”:** æ³¨æ–‡æƒ…å ±ç®¡ç†

**è¨­è¨ˆç†ç”±:**
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ³¨æ–‡å±¥æ­´ã‚’è¨˜éŒ²ã—ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¿½è·¡ãƒ»åˆ†æžã«æ´»ç”¨

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/003_create_orders_reviews.sql` ã«å«ã¾ã‚Œã¾ã™

```sql
CREATE TABLE orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    shipping_address TEXT,
    tracking_number VARCHAR(100),
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    shipped_at TIMESTAMP NULL,
    delivered_at TIMESTAMP NULL,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž | ä¾‹ |
|--------|-----|------|-----|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ | 1001 |
| `user_id` | BIGINT UNSIGNED (FK) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | 5 |
| `total_amount` | DECIMAL(10, 2) | æ³¨æ–‡åˆè¨ˆé‡‘é¡ | 250000.50 |
| `status` | ENUM | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | 'processing' |
| `shipping_address` | TEXT | é…é€å…ˆä½æ‰€ | ã€Œæ±äº¬éƒ½æ¸‹è°·åŒº...ã€ |
| `tracking_number` | VARCHAR(100) | è¿½è·¡ç•ªå· | ã€ŒYT123456789ã€ |
| `notes` | TEXT | å‚™è€ƒ | ã€Œã‚®ãƒ•ãƒˆåŒ…è£…å¸Œæœ›ã€ |
| `created_at` | TIMESTAMP | æ³¨æ–‡æ—¥æ™‚ | è‡ªå‹• |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¥æ™‚ | è‡ªå‹•æ›´æ–° |
| `shipped_at` | TIMESTAMP | ç™ºé€æ—¥æ™‚ | ç™ºé€å‰ã¯NULL |
| `delivered_at` | TIMESTAMP | é…é”æ—¥æ™‚ | é…é”å‰ã¯NULL |

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤:**
```
'pending'     â†’ æ³¨æ–‡å—ã‘å–ã‚Š
'processing'  â†’ å‡¦ç†ä¸­
'shipped'     â†’ ç™ºé€æ¸ˆã¿
'delivered'   â†’ é…é”å®Œäº†
'cancelled'   â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
```

**ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤:**
```
ON DELETE CASCADE
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ™‚ã€ãã®æ³¨æ–‡ã‚‚è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹

---

### 5. order_items ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ãƒ»Phase 3ï¼‰

**ç”¨é€”:** å¤šå¯¾å¤šé–¢ä¿‚ã®è§£æ±ºï¼ˆorder 1:N productsï¼‰

**è¨­è¨ˆç†ç”±:**
1ã¤ã®æ³¨æ–‡ã«è¤‡æ•°ã®è£½å“ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’è¡¨ç¾

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/003_create_orders_reviews.sql` ã«å«ã¾ã‚Œã¾ã™

```sql
CREATE TABLE order_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    order_id BIGINT UNSIGNED NOT NULL,
    product_id BIGINT UNSIGNED NOT NULL,
    quantity INT UNSIGNED NOT NULL DEFAULT 1,
    unit_price DECIMAL(10, 2) NOT NULL,
    subtotal DECIMAL(10, 2) AS (quantity * unit_price) VIRTUAL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE RESTRICT,
    INDEX idx_order_id (order_id),
    INDEX idx_product_id (product_id),
    UNIQUE KEY uk_order_product (order_id, product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž | ä¾‹ |
|--------|-----|------|-----|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ | 5001 |
| `order_id` | BIGINT UNSIGNED (FK) | æ³¨æ–‡ID | 1001 |
| `product_id` | BIGINT UNSIGNED (FK) | è£½å“ID | 42 |
| `quantity` | INT UNSIGNED | æ•°é‡ | 3 |
| `unit_price` | DECIMAL(10, 2) | **æ³¨æ–‡æ™‚**ã®å˜ä¾¡ | 50000.00 |
| `subtotal` | DECIMAL(10, 2) VIRTUAL | å°è¨ˆï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰ | 150000.00 |
| `created_at` | TIMESTAMP | ä½œæˆæ—¥æ™‚ | è‡ªå‹• |

**é‡è¦ãªè¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ:**

1. **unit_price ãŒå¿…é ˆãªç†ç”±**
   ```
   âŒ é–“é•ã„: order_items â†’ products.price ã‚’å‚ç…§
   â†’ è£½å“ä¾¡æ ¼ãŒå¾Œã§å¤‰æ›´ã•ã‚Œã‚‹ã¨ã€æ³¨æ–‡å±¥æ­´ã®ä¾¡æ ¼ãŒå¤‰ã‚ã‚‹

   âœ… æ­£ã—ã„: order_items ã« unit_price ã‚’è¨˜éŒ²
   â†’ æ³¨æ–‡å½“æ™‚ã®ä¾¡æ ¼ãŒæ°¸é ã«ä¿å­˜ã•ã‚Œã‚‹
   ```

2. **VIRTUAL ã‚«ãƒ©ãƒ **
   ```
   AS (quantity * unit_price) VIRTUAL
   â†’ quantity/unit_price ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨è‡ªå‹•è¨ˆç®—
   â†’ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŠ¹çŽ‡åŒ–ï¼ˆä»®æƒ³ã‚«ãƒ©ãƒ ã¯ä¿å­˜ã•ã‚Œãªã„ï¼‰
   ```

3. **UNIQUE KEY**
   ```
   UNIQUE KEY uk_order_product (order_id, product_id)
   â†’ åŒã˜æ³¨æ–‡ã«åŒã˜è£½å“ã‚’è¤‡æ•°è¡Œã§ç™»éŒ²ã™ã‚‹ã“ã¨ã‚’é˜²æ­¢
   â†’ quantity å¢—åŠ ã§å¯¾å¿œ
   ```

4. **DELETE ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**
   ```
   order_id: ON DELETE CASCADE
   â†’ æ³¨æ–‡å‰Šé™¤æ™‚ã€ãã®ä¸­èº«ï¼ˆitemsï¼‰ã‚‚å‰Šé™¤

   product_id: ON DELETE RESTRICT
   â†’ è£½å“å‰Šé™¤æ™‚ã€ãã‚Œã‚’å«ã‚€ã‚ªãƒ¼ãƒ€ãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤ã‚’æ‹’å¦
   ```

---

### 6. reviews ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ãƒ»Phase 3ï¼‰

**ç”¨é€”:** è£½å“ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†

**è¨­è¨ˆç†ç”±:**
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè£½å“ã«æŠ•ç¨¿ã—ãŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¨˜éŒ²ã€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é›†è¨ˆã«æ´»ç”¨

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/003_create_orders_reviews.sql` ã«å«ã¾ã‚Œã¾ã™

```sql
CREATE TABLE reviews (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    product_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    rating TINYINT UNSIGNED NOT NULL CHECK (rating >= 1 AND rating <= 5),
    title VARCHAR(200),
    comment TEXT,
    helpful_count INT UNSIGNED DEFAULT 0,
    is_verified_purchase BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_product_id (product_id),
    INDEX idx_user_id (user_id),
    INDEX idx_rating (rating),
    INDEX idx_created_at (created_at),
    UNIQUE KEY uk_user_product (user_id, product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž | ä¾‹ |
|--------|-----|------|-----|
| `id` | BIGINT UNSIGNED | ãƒ—ãƒ©ã‚¤ãƒžãƒªãƒ¼ã‚­ãƒ¼ | 8001 |
| `product_id` | BIGINT UNSIGNED (FK) | è£½å“ID | 42 |
| `user_id` | BIGINT UNSIGNED (FK) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | 5 |
| `rating` | TINYINT UNSIGNED | è©•ä¾¡ï¼ˆ1-5ï¼‰ | 5 |
| `title` | VARCHAR(200) | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ« | ã€Œç´ æ™´ã‚‰ã—ã„è£½å“ï¼ã€ |
| `comment` | TEXT | ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡ | ã€Œãƒ‡ã‚¶ã‚¤ãƒ³ãŒç¾Žã—ã...ã€ |
| `helpful_count` | INT UNSIGNED | å½¹ç«‹ã¡æŠ•ç¥¨æ•° | 25 |
| `is_verified_purchase` | BOOLEAN | è³¼å…¥è€…ãƒ•ãƒ©ã‚° | TRUE/FALSE |
| `created_at` | TIMESTAMP | æŠ•ç¨¿æ—¥æ™‚ | è‡ªå‹• |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¥æ™‚ | è‡ªå‹•æ›´æ–° |

**CHECKåˆ¶ç´„:**
```
CHECK (rating >= 1 AND rating <= 5)
```
1ï½ž5ã®æ˜Ÿè©•ä¾¡ã®ã¿å—ã‘ä»˜ã‘ã‚‹ï¼ˆDB ãƒ¬ãƒ™ãƒ«ã§ã®æ¤œè¨¼ï¼‰

**UNIQUE KEY:**
```
UNIQUE KEY uk_user_product (user_id, product_id)
```
åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜è£½å“ã«è¤‡æ•°ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚’é˜²æ­¢

---

## å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Step 1: ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/002_create_product_tables.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/migrations/002_create_product_tables.sql`

```bash
cd /Users/haytakeda/Sites/RESTAPI/db/migrations
cat > 002_create_product_tables.sql << 'EOF'
BEGIN;

CREATE TABLE product_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    icon_url VARCHAR(500),
    display_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_name (name),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE products (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    category_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    stock INT UNSIGNED NOT NULL DEFAULT 0,
    image_url VARCHAR(500),
    sku VARCHAR(100) UNIQUE,
    is_featured BOOLEAN DEFAULT FALSE,
    rating DECIMAL(3, 2) DEFAULT 0.00,
    reviews_count INT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (category_id) REFERENCES product_categories(id) ON DELETE RESTRICT,
    INDEX idx_category_id (category_id),
    INDEX idx_price (price),
    INDEX idx_is_featured (is_featured),
    FULLTEXT INDEX idx_fulltext_search (name, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

COMMIT;
EOF
```

**æ³¨æ„:** `003_create_orders_reviews.sql` ã¯ Phase 3 ã§ä½œæˆï¼ˆä»¥ä¸‹ã‚’å‚ç…§ï¼‰

---

## Phase 3: æ³¨æ–‡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®è¿½åŠ 

### Step 7: Phase 3 ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/migrations/003_create_orders_reviews.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/migrations/003_create_orders_reviews.sql`

```bash
cd /Users/haytakeda/Sites/RESTAPI/db/migrations
cat > 003_create_orders_reviews.sql << 'EOF'
BEGIN;

CREATE TABLE orders (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    shipping_address TEXT,
    tracking_number VARCHAR(100),
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    shipped_at TIMESTAMP NULL,
    delivered_at TIMESTAMP NULL,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE order_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    order_id BIGINT UNSIGNED NOT NULL,
    product_id BIGINT UNSIGNED NOT NULL,
    quantity INT UNSIGNED NOT NULL DEFAULT 1,
    unit_price DECIMAL(10, 2) NOT NULL,
    subtotal DECIMAL(10, 2) AS (quantity * unit_price) VIRTUAL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE RESTRICT,
    INDEX idx_order_id (order_id),
    INDEX idx_product_id (product_id),
    UNIQUE KEY uk_order_product (order_id, product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE reviews (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    product_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    rating TINYINT UNSIGNED NOT NULL CHECK (rating >= 1 AND rating <= 5),
    title VARCHAR(200),
    comment TEXT,
    helpful_count INT UNSIGNED DEFAULT 0,
    is_verified_purchase BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_product_id (product_id),
    INDEX idx_user_id (user_id),
    INDEX idx_rating (rating),
    INDEX idx_created_at (created_at),
    UNIQUE KEY uk_user_product (user_id, product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

COMMIT;
EOF
```

---

### Step 8: Phase 3 ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/seeds/004_orders.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/seeds/004_orders.sql`

```bash
cat > /Users/haytakeda/Sites/RESTAPI/db/seeds/004_orders.sql << 'EOF'
INSERT INTO orders (user_id, total_amount, status, shipping_address, notes, created_at) VALUES
(1, 300000.00, 'delivered', 'æ±äº¬éƒ½æ¸‹è°·åŒºé“çŽ„å‚1-2-3', 'ã‚®ãƒ•ãƒˆåŒ…è£…å¸Œæœ›', '2026-02-10 10:00:00'),
(2, 155000.00, 'shipped', 'å¤§é˜ªåºœå¤§é˜ªå¸‚åŒ—åŒºä¸­ä¹‹å³¶1-1-1', '', '2026-02-15 14:30:00'),
(1, 17000.00, 'processing', 'æ±äº¬éƒ½æ¸‹è°·åŒºé“çŽ„å‚1-2-3', 'é…é”æ™‚é–“å¸¯ï¼š16æ™‚-18æ™‚', '2026-02-16 09:15:00');
EOF
```

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/seeds/005_order_items.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/seeds/005_order_items.sql`

```bash
cat > /Users/haytakeda/Sites/RESTAPI/db/seeds/005_order_items.sql << 'EOF'
INSERT INTO order_items (order_id, product_id, quantity, unit_price) VALUES
(1, 1, 1, 150000.00),  -- iPhone 15 Pro: 1å€‹
(1, 4, 5, 2000.00),    -- Tã‚·ãƒ£ãƒ„: 5å€‹
(1, 3, 1, 130000.00),  -- iPad Pro: 1å€‹
(2, 2, 1, 140000.00),  -- Galaxy S24: 1å€‹
(2, 5, 1, 15000.00),   -- ãƒ™ãƒƒãƒ‰: 1å€‹
(3, 5, 1, 15000.00),   -- ãƒ™ãƒƒãƒ‰: 1å€‹
(3, 6, 1, 1500.00);    -- æ›¸ç±: 1å€‹
EOF
```

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/seeds/006_reviews.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/seeds/006_reviews.sql`

```bash
cat > /Users/haytakeda/Sites/RESTAPI/db/seeds/006_reviews.sql << 'EOF'
INSERT INTO reviews (product_id, user_id, rating, title, comment, is_verified_purchase) VALUES
(1, 1, 5, 'ç´ æ™´ã‚‰ã—ã„ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³', 'ã‚«ãƒ¡ãƒ©æ€§èƒ½ãŒæœ€é«˜ã§ã™ã€‚æ¯Žæ—¥ä½¿ã£ã¦ã¾ã™ã€‚', TRUE),
(1, 2, 4, 'ãƒãƒƒãƒ†ãƒªãƒ¼æŒã¡ãŒè‰¯ã„', 'ä¾¡æ ¼ã¯é«˜ã„ã§ã™ãŒã€æº€è¶³ã—ã¦ã„ã¾ã™ã€‚', TRUE),
(2, 2, 5, 'æœ€æ–°ã‚¹ãƒžãƒ›ã®æ±ºå®šç‰ˆ', 'Snapdragonæ­è¼‰ã§å‹•ä½œãŒã‚¹ãƒ ãƒ¼ã‚ºã€‚', TRUE),
(3, 1, 4, 'ç”»é¢ãŒç¶ºéº—', 'iPadã¨ã—ã¦ã¯ååˆ†ã§ã™ã€‚', TRUE),
(4, 2, 3, 'ã‚µã‚¤ã‚ºæ„ŸãŒå¾®å¦™', 'ã‚‚ã†å°‘ã—å¤§ãã„ã¨è‰¯ã‹ã£ãŸã€‚', FALSE),
(5, 1, 5, 'ã‚³ã‚¹ãƒ‘æœ€é«˜', 'ãƒ‹ãƒˆãƒªã®ãƒ™ãƒƒãƒ‰ã¯ä¿¡é ¼ã§ãã¾ã™ã€‚', TRUE);
EOF
```

---

### Step 2: Phase 2 ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/seeds/002_product_categories.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/seeds/002_product_categories.sql`

```bash
cat > /Users/haytakeda/Sites/RESTAPI/db/seeds/002_product_categories.sql << 'EOF'
INSERT INTO product_categories (name, description, display_order, is_active) VALUES
('ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹', 'ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€ãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ãªã©', 1, TRUE),
('è¡£æœ', 'ãƒ¡ãƒ³ã‚ºã€ã‚¦ã‚£ãƒ¡ãƒ³ã‚ºã€å­ä¾›æœ', 2, TRUE),
('å®¶åº­ç”¨å“', 'å®¶å…·ã€å¯å…·ã€ã‚­ãƒƒãƒãƒ³ç”¨å“', 3, TRUE),
('æ›¸ç±', 'å°èª¬ã€å‚è€ƒæ›¸ã€æ¼«ç”»', 4, TRUE),
('ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢', 'ã‚¹ãƒãƒ¼ãƒ„ç”¨å“ã€ã‚­ãƒ£ãƒ³ãƒ—è£…å‚™', 5, TRUE);
EOF
```

ðŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«:** `db/seeds/003_products.sql`

**ä¿å­˜å…ˆ:** `/Users/haytakeda/Sites/RESTAPI/db/seeds/003_products.sql`

```bash
cat > /Users/haytakeda/Sites/RESTAPI/db/seeds/003_products.sql << 'EOF'
INSERT INTO products (category_id, name, description, price, stock, sku, is_featured, rating) VALUES
(1, 'iPhone 15 Pro', 'é«˜æ€§èƒ½A17 Proãƒãƒƒãƒ—æ­è¼‰ã€ãƒ—ãƒ­ã‚°ãƒ¬ãƒ¼ãƒ‰æ’®å½±ã‚«ãƒ¡ãƒ©', 150000.00, 50, 'SKU-IP15P-001', TRUE, 4.8),
(1, 'Samsung Galaxy S24', '120Hzæœ‰æ©ŸELã€æœ€æ–°Snapdragonæ­è¼‰', 140000.00, 30, 'SKU-SGS24-001', TRUE, 4.7),
(1, 'iPad Pro', 'M2ãƒãƒƒãƒ—ã€11ã‚¤ãƒ³ãƒãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤', 130000.00, 20, 'SKU-IPAD-001', FALSE, 4.6),
(2, 'ãƒ¦ãƒ‹ã‚¯ãƒ­ ãƒ¡ãƒ³ã‚ºTã‚·ãƒ£ãƒ„', 'å¿«é©ãªç€å¿ƒåœ°ã€å¤šè‰²å±•é–‹', 2000.00, 200, 'SKU-UNIQ-001', FALSE, 4.3),
(3, 'ãƒ‹ãƒˆãƒª ãƒ™ãƒƒãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ', 'ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ã‚ºã€ç°¡å˜çµ„ã¿ç«‹ã¦', 15000.00, 15, 'SKU-NITORI-001', FALSE, 4.5),
(4, 'å¾è¼©ã¯çŒ«ã§ã‚ã‚‹ï¼ˆæ–°è£…ç‰ˆï¼‰', 'å¤ç›®æ¼±çŸ³ã®å¤å…¸ä½œå“', 1500.00, 100, 'SKU-BOOK-001', FALSE, 4.9);
EOF
```

---

### Step 3: Phase 2 - docker-compose.yml æ›´æ–°

**ç†ç”±:**
Phase 2 ã®ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠåˆæœŸåŒ–æ™‚ã«è‡ªå‹•å®Ÿè¡Œ

**ä¿®æ­£ç®‡æ‰€:**

```yaml
db:
  volumes:
    - db_data:/var/lib/mysql
    - ./db/init/00_init.sql:/docker-entrypoint-initdb.d/00_init.sql
    - ./db/migrations/001_create_users.sql:/docker-entrypoint-initdb.d/01_001_create_users.sql
    - ./db/migrations/002_create_product_tables.sql:/docker-entrypoint-initdb.d/02_002_create_product_tables.sql
    - ./db/seeds/001_users.sql:/docker-entrypoint-initdb.d/03_001_users.sql
    - ./db/seeds/002_product_categories.sql:/docker-entrypoint-initdb.d/04_002_product_categories.sql
    - ./db/seeds/003_products.sql:/docker-entrypoint-initdb.d/05_003_products.sql
```

---

### Step 4: Phase 3 - docker-compose.yml æ‹¡å¼µ

**ä¿®æ­£ç®‡æ‰€ï¼š**

ä¸Šè¨˜ã® db.volumes ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```yaml
    - ./db/migrations/003_create_orders_reviews.sql:/docker-entrypoint-initdb.d/03_003_create_orders_reviews.sql
    - ./db/seeds/004_orders.sql:/docker-entrypoint-initdb.d/06_004_orders.sql
    - ./db/seeds/005_order_items.sql:/docker-entrypoint-initdb.d/07_005_order_items.sql
    - ./db/seeds/006_reviews.sql:/docker-entrypoint-initdb.d/08_006_reviews.sql
```

**å®Ÿè¡Œé †åºï¼š**
- 00_: init SQL
- 01_: Migration 001 (Phase 1)
- 02_: Migration 002 (Phase 2)
- 03_: Migration 003 (Phase 3)
- 04-08_: Seed data (1-6)

---

### Step 5: ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ï¼ˆå…¨ãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–ï¼‰

```bash
# ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¦å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
docker compose down --volumes

# ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼ˆè‡ªå‹•çš„ã«ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚·ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
docker compose up -d

# ãƒ­ã‚°ã§åˆæœŸåŒ–çŠ¶æ³ã‚’ç¢ºèª
docker compose logs db | grep -E "CREATE TABLE|product|order|review|COMMIT"
```

---

### Step 6: DBã«æŽ¥ç¶šã—ã¦å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª

```bash
# MySQLæŽ¥ç¶š
mysql -h 127.0.0.1 -u app -p"app_password" app_db

# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
SHOW TABLES;

# å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ç¢ºèª
SELECT COUNT(*) as users_count FROM users;
SELECT COUNT(*) as categories_count FROM product_categories;
SELECT COUNT(*) as products_count FROM products;
SELECT COUNT(*) as orders_count FROM orders;
SELECT COUNT(*) as order_items_count FROM order_items;
SELECT COUNT(*) as reviews_count FROM reviews;
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**

```
Tables_in_app_db
order_items
orders
product_categories
products
reviews
users

users_count: 3
categories_count: 5
products_count: 6
orders_count: 3
order_items_count: 7
reviews_count: 6
```

---

### Step 7: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª

**æ³¨æ–‡ã¨è£½å“ã®æ•´åˆæ€§:**

```bash
mysql -h 127.0.0.1 -u app -p"app_password" app_db -e "
SELECT 
  o.id as order_id,
  o.user_id,
  COUNT(oi.id) as item_count,
  SUM(oi.subtotal) as total
FROM orders o
LEFT JOIN order_items oi ON o.id = oi.order_id
GROUP BY o.id;
"
```

**æœŸå¾…çµæžœ:**
```
order_id  user_id  item_count  total
1        1        3           300000.00
2        2        2           155000.00
3        1        2           16500.00
```

---

### Step 8: ãƒ¬ãƒ“ãƒ¥ãƒ¼é›†è¨ˆç¢ºèª

```bash
mysql -h 127.0.0.1 -u app -p"app_password" app_db -e "
SELECT 
  p.id,
  p.name,
  COUNT(r.id) as review_count,
  ROUND(AVG(r.rating), 2) as avg_rating
FROM products p
LEFT JOIN reviews r ON p.id = r.product_id
GROUP BY p.id;
"
```

**æœŸå¾…çµæžœ:**
å„è£½å“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã¨å¹³å‡ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## æ¤œè¨¼æ–¹æ³•

### å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ç¢ºèª

```bash
mysql -h 127.0.0.1 -u app -p"app_password" app_db -e "
SELECT TABLE_NAME, COLUMN_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_NAME IS NOT NULL
ORDER BY TABLE_NAME;
"
```

**æœŸå¾…çµæžœ:**
```
TABLE_NAME    | COLUMN_NAME   | REFERENCED_TABLE | REFERENCED_COLUMN
products      | category_id   | product_categories | id
order_items   | order_id      | orders           | id
order_items   | product_id    | products         | id
orders        | user_id       | users            | id
reviews       | product_id    | products         | id
reviews       | user_id       | users            | id
```

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª

```bash
mysql -h 127.0.0.1 -u app -p"app_password" app_db -e "
SELECT TABLE_NAME, INDEX_NAME, COLUMN_NAME
FROM INFORMATION_SCHEMA.STATISTICS
WHERE TABLE_NAME IN ('products', 'product_categories', 'orders', 'reviews')
ORDER BY TABLE_NAME, INDEX_NAME;
"
```

**ç¢ºèªç‚¹:**
- `products` ã« `idx_category_id`, `idx_price`, `idx_is_featured` ãŒã‚ã‚‹
- `orders` ã« `idx_user_id`, `idx_status`, `idx_created_at` ãŒã‚ã‚‹

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ 1: "å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚¨ãƒ©ãƒ¼" ã§ INSERT ãŒå¤±æ•—

**ç—‡çŠ¶:**
```
ERROR 1452: Cannot add or update a child row: a foreign key constraint fails
```

**åŽŸå› :**
å‚ç…§å…ˆãƒ†ãƒ¼ãƒ–ãƒ«ã«å­˜åœ¨ã—ãªã„IDã‚’æŒ‡å®šã—ãŸ

**è§£æ±º:**
```bash
# å‚ç…§å…ˆã®IDç¢ºèª
SELECT id FROM product_categories WHERE name = 'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹';

# ãã® ID ã‚’ä½¿ç”¨ã—ã¦ INSERT
INSERT INTO products (..., category_id) VALUES (..., 1);
```

---

### å•é¡Œ 2: "Duplicate entry" ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
```
ERROR 1062: Duplicate entry 'iPhone 15 Pro' for key 'name'
```

**åŽŸå› :**
UNIQUEåˆ¶ç´„ã®ã‚ã‚‹ã‚«ãƒ©ãƒ ã«é‡è¤‡ã—ãŸå€¤ã‚’æŒ¿å…¥ã—ãŸ

**è§£æ±º:**
```bash
# æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç¢ºèª
SELECT * FROM products WHERE name = 'iPhone 15 Pro';

# åˆ¥ã®åå‰ã§æŒ¿å…¥
INSERT INTO products (name, ...) VALUES ('iPhone 15 Pro Max', ...);
```

---

### å•é¡Œ 3: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶:**
```
ERROR 1146: Table 'app_db.products' doesn't exist
```

**åŽŸå› :**
ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**è§£æ±º:**
```bash
# ãƒœãƒªãƒ¥ãƒ¼å‰Šé™¤ã—ã¦ãƒªã‚»ãƒƒãƒˆ
docker compose down --volumes
docker compose up -d

# ãƒ­ã‚°ç¢ºèª
docker compose logs db | tail -50
```

---

## å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ä¸€è¦§

| å­ãƒ†ãƒ¼ãƒ–ãƒ« | ã‚«ãƒ©ãƒ  | è¦ªãƒ†ãƒ¼ãƒ–ãƒ« | è¦ªã‚«ãƒ©ãƒ  | DELETE ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|-----------|--------|-----------|--------|------------------|
| `products` | `category_id` | `product_categories` | `id` | RESTRICT |
| `orders` | `user_id` | `users` | `id` | CASCADE |
| `order_items` | `order_id` | `orders` | `id` | CASCADE |
| `order_items` | `product_id` | `products` | `id` | RESTRICT |
| `reviews` | `product_id` | `products` | `id` | CASCADE |
| `reviews` | `user_id` | `users` | `id` | CASCADE |

**DELETE ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ„å‘³:**
- `CASCADE`: è¦ªãƒ¬ã‚³ãƒ¼ãƒ‰å‰Šé™¤æ™‚ã€é–¢é€£ã™ã‚‹å­ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚‚è‡ªå‹•å‰Šé™¤
- `RESTRICT`: è¦ªãƒ¬ã‚³ãƒ¼ãƒ‰ã«é–¢é€£ã™ã‚‹å­ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°å‰Šé™¤ã‚’æ‹’å¦

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

âœ… **Database å®Ÿè£…å®Œäº†** - Phase 1-3 å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå®Œäº†

ðŸ’¡ **Backend API é–‹ç™º**
- [BACKEND_APP_DEVELOPMENT.md](BACKEND_APP_DEVELOPMENT.md) ã‚’å‚ç…§
- Phase 2: è£½å“ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼APIå®Ÿè£…
- Phase 3: æ³¨æ–‡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼APIå®Ÿè£…

ðŸ’¡ **Frontend é–‹ç™º**
- [FRONTEND_APP_DEVELOPMENT.md](FRONTEND_APP_DEVELOPMENT.md) ã‚’å‚ç…§
- Phase 2: è£½å“ãƒªã‚¹ãƒˆãƒ»è©³ç´°ãƒšãƒ¼ã‚¸å®Ÿè£…
- Phase 3: æ³¨æ–‡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½å®Ÿè£…

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ‰ã¯ä»¥ä¸‹ã¨é€£æºã—ã¦ã„ã¾ã™ï¼š

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | å†…å®¹ | é–¢é€£ãƒ•ã‚§ãƒ¼ã‚º |
|-----------|------|----------|
| [BACKEND_APP_DEVELOPMENT.md](BACKEND_APP_DEVELOPMENT.md) | APIå®Ÿè£…ã‚¬ã‚¤ãƒ‰ | Phase 2-3 |
| [FRONTEND_APP_DEVELOPMENT.md](FRONTEND_APP_DEVELOPMENT.md) | UIå®Ÿè£…ã‚¬ã‚¤ãƒ‰ | Phase 2-3 |
| [db/ER_DIAGRAM.md](db/ER_DIAGRAM.md) | ERå›³ï¼ˆMermaidï¼‰ | Phase 1-3 |
| [db/README.md](db/README.md) | DBè¨­è¨ˆã®åŸºæœ¬æ–¹é‡ | Phase 1-3 |

---

## å‚è€ƒè³‡æ–™

ãƒ†ãƒ¼ãƒ–ãƒ«é–¢ä¿‚ã‚„å¤–éƒ¨ã‚­ãƒ¼ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆï¼š
- [ER_DIAGRAM.md](db/ER_DIAGRAM.md) - Mermaidå½¢å¼ã®ERå›³
- [db/README.md](db/README.md) - DBè¨­è¨ˆã®åŸºæœ¬æ–¹é‡
